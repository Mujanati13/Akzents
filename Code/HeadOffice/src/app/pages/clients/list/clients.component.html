<section>
  <h2 translate class="flex text-primary-700 mb-8">
    <app-icon name="clients" class="w-9 flex items-center mr-1 text-primary-700" />
    <span class="text-[32px] font-bold font-dm">Kunden </span>
  </h2>

  <div class="mb-8 grid grid-cols-2 xl:grid-cols-6 gap-4 items-center">
    <!-- Alle Kunden button -->
    <button
      class="h-[49px] flex-1 min-w-0 font-dm font-bold text-primary-500 rounded-md transition-shadow duration-200 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
      [disabled]="isLoading"
      [ngStyle]="{
        'box-shadow': activeFilter === 'all' ? '0 0 0 3px rgba(0, 111, 155, 0.7)' : '0 0 0 3px rgba(0, 0, 0, 0.09)',
      }"
      (click)="showAllClients()"
    >
      Alle Kunden
    </button>

    <!-- Meine Kunden button -->
    <button
      class="h-[49px] flex-1 min-w-0 font-dm font-bold text-primary-500 rounded-md transition-shadow duration-200 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
      [disabled]="isLoading"
      [ngStyle]="{
        'box-shadow': activeFilter === 'my-clients' ? '0 0 0 3px rgba(0, 111, 155, 0.7)' : '0 0 0 3px rgba(0, 0, 0, 0.09)',
      }"
      (click)="toggleMyClientsFilter()"
    >
      Meine Kunden
    </button>

    <!-- Search input with icon inside -->
    <div class="relative flex-1 min-w-0 col-span-2">
      <input
        type="text"
        placeholder="Suche nach Kunden"
        [class]="'h-[54px] px-4 border border-gray-300 rounded-md font-inter text-sm w-full focus:outline-none focus:ring-0 focus:border-primary-500 disabled:bg-gray-100 disabled:cursor-not-allowed' + (searchTerm && searchTerm.length > 0 ? ' pr-10' : '')"
        [value]="searchTerm"
        [disabled]="isLoading"
        (input)="onSearchInput($event)"
      />
      <app-icon *ngIf="!searchTerm || searchTerm.length === 0" name="search" class="absolute right-2 top-1/2 transform -translate-y-1/2 w-[19px] h-[19px] text-gray-500" />
      <button
        *ngIf="searchTerm && searchTerm.length > 0"
        type="button"
        (click)="clearSearch()"
        class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 cursor-pointer transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        title="Suche lÃ¶schen"
        [disabled]="isLoading"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

      <!-- Clear filters button -->
      <div class="place-content-center cursor-pointer" *ngIf="hasActiveFilters()">
        <button
          (click)="clearFilters()"
          class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors text-sm cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
          [disabled]="isLoading"
        >
          Alle anzeigen
        </button>
      </div>
    <div class="flex-1 min-w-0 flex items-center col-span-2 xl:col-span-1">
      <button
        class="h-[54px] w-full font-inter text-white bg-primary-500 rounded-md flex space-x-[12px] items-center justify-center text-sm cursor-pointer"
        [disabled]="isLoading"
        (click)="navigateToAddClient()"
      >
        <app-icon name="plus" class="w-[13.8px] h-[13.8px]" />
        <span>Neuen kunden anlegen</span>
      </button>
    </div>

  </div>



  <!-- Loading state -->
  <div *ngIf="isLoading && cards.length === 0" class="text-center py-8">
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"></div>
    <p class="text-gray-500 mt-2">Lade Kunden...</p>
  </div>

  <!-- Empty state when no results -->
  <div *ngIf="!isLoading && cards.length === 0" class="text-center py-8">
    <p class="text-gray-500 text-lg mb-2">Keine Kunden gefunden</p>
    <p class="text-gray-400 text-sm" *ngIf="searchTerm || showOnlyFavorites">Versuchen Sie andere Suchbegriffe oder entfernen Sie Filter</p>
    <button class="mt-4 px-4 cursor-pointer py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600 transition-colors" routerLink="/clients/add">Ersten Kunden anlegen</button>
  </div>

  <!-- Client cards grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-6" *ngIf="cards.length > 0">
    <!-- Client cards -->
    <div
      *ngFor="let item of cards; let i = index"
      [ngClass]="{
        'bg-green-50 border-2 border-green-500': isMyClient(item.id),
        'bg-white border border-[#DEE2E6]': !isMyClient(item.id)
      }"
      [ngStyle]="{
        'box-shadow': isMyClient(item.id) ? '0px 0px 3.5px 3px rgba(0, 128, 0, 0.13)' : '0px 0px 3.5px 3px rgba(0, 0, 0, 0.13)'
      }"
      class="rounded-[20px] px-[30px] pt-[21px] pb-[16px] flex flex-col space-y-4 hover:shadow-lg transition-shadow cursor-pointer"
    >
      <div class="flex justify-between items-start h-[73px]">
        <!-- Company logo -->
        <a [routerLink]="['/clients', item.id]" class="h-[53px] sm:h-[45px] md:h-[40px] max-w-[70%] flex items-center">
          <img *ngIf="item.logo?.path; else defaultLogo" [src]="item.logo.path" [alt]="item.name" class="h-full object-contain max-w-full" (error)="$event.target.style.display = 'none'" />
          <ng-template #defaultLogo>
            <div class="h-full w-20 bg-gray-100 rounded-lg flex items-center justify-center">
              <span class="text-gray-400 text-xs font-bold">{{ item.name.charAt(0) }}</span>
            </div>
          </ng-template>
        </a>
        <div class="flex items-center space-x-2">
          <a (click)="navigateToClientEdit(item.id)" class="cursor-pointer inline-flex items-center">
            <app-icon name="pencil" class="w-6 h-6 text-primary-500" title="Bearbeiten" />
          </a>
          <app-favorite-toggle class="h-6 w-6 flex-shrink-0" [isFavorite]="item.isFavorite" (favoriteChange)="onFavoriteChanged($event, item)" (contextmenu)="onFavoriteContextMenu($event, item.id)" />
        </div>
      </div>

      <!-- Stats -->
      <ul class="text-sm text-primary-200 space-y-2">
        <li>
          <a *ngIf="(item.reportCounts?.newReports || 0) > 0" [routerLink]="['/clients', item.id]" [queryParams]="{ status: 'new' }" class="block">
          <span class="border rounded-full aspect-square px-1 text-black">{{ item.reportCounts?.newReports || 0 }}</span>
          <span class="text-primary-500">neue Reports</span>
          </a>
          <span *ngIf="(item.reportCounts?.newReports || 0) === 0" class="block cursor-default
          ">
          <span class="border rounded-full aspect-square px-1 text-black">{{ item.reportCounts?.newReports || 0 }}</span>
          <span class="text-primary-500">neue Reports</span>
          </span>
        </li>
        <li>
          <a *ngIf="(item.reportCounts?.ongoingReports || 0) > 0" [routerLink]="['/clients', item.id]" [queryParams]="{ status: 'ongoing' }" class="block">
          <span class="border rounded-full aspect-square px-1 text-black">{{ item.reportCounts?.ongoingReports || 0 }}</span>
          <span class="text-primary-500">offene Reports</span>
          </a>
          <span *ngIf="(item.reportCounts?.ongoingReports || 0) === 0" class="block cursor-default">
          <span class="border rounded-full aspect-square px-1 text-black">{{ item.reportCounts?.ongoingReports || 0 }}</span>
          <span class="text-primary-500">offene Reports</span>
          </span>
        </li>
        <li>
          <a *ngIf="(item.reportCounts?.completedReports || 0) > 0" [routerLink]="['/clients', item.id]" [queryParams]="{ status: 'completed' }" class=" block">
          <span class="border rounded-full aspect-square px-1 text-black">{{ item.reportCounts?.completedReports || 0 }}</span>
          <span class="text-primary-500">abgeschlossene Reports</span>
          </a>
          <span *ngIf="(item.reportCounts?.completedReports || 0) === 0" class="block cursor-default">
          <span class="border rounded-full aspect-square px-1 text-black">{{ item.reportCounts?.completedReports || 0 }}</span>
          <span class="text-primary-500">abgeschlossene Reports</span>
          </span>
        </li>
      </ul>
    </div>
  </div>

  <!-- Load more button -->
  <div class="text-center mt-8" *ngIf="hasNextPage && !isLoading">
    <button class="px-6 py-3 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" [disabled]="isLoadingMore" (click)="loadMore()">
      <span *ngIf="!isLoadingMore">Weitere Kunden laden</span>
      <span *ngIf="isLoadingMore" class="flex items-center gap-2">
        <div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500"></div>
        Lade...
      </span>
    </button>
  </div>

  <!-- Results count -->
  <div class="mt-4 text-center text-sm text-gray-500" *ngIf="!isLoading">
    {{ cards.length }} von {{ allCards.length }} Kunden angezeigt
    <span *ngIf="searchTerm || showOnlyFavorites">(gefiltert)</span>
  </div>
</section>
