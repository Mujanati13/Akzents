<section>
  <h2 translate class="flex text-primary-700 mb-8">
    <app-icon name="clients" class="w-9 flex items-center mr-1 text-primary-700" />
    <span class="text-[32px] font-bold font-dm">Kunden</span>
  </h2>

  <div class="mb-8 grid grid-cols-1 lg:grid-cols-[209px_209px_400px_auto] xl:grid-cols-[209px_209px_552px_auto] gap-[15px] items-center">
    <!-- Alle Kunden button -->
    <button
      class="h-[49px] flex-1 min-w-0 font-dm font-bold text-primary-500 rounded-md transition-shadow duration-200 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
      [disabled]="isLoading"
      [ngStyle]="{
        'box-shadow': activeFilter === 'all' ? '0 0 0 3px rgba(0, 111, 155, 0.7)' : '0 0 0 3px rgba(0, 0, 0, 0.09)',
      }"
      (click)="showAllClients()"
    >
      Alle Kunden
    </button>

    <!-- Favoriten button -->
    <button
      class="h-[49px] flex-1 min-w-0 font-dm font-bold text-primary-500 rounded-md transition-shadow duration-200 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
      [disabled]="isLoading"
      [ngStyle]="{
        'box-shadow': activeFilter === 'favorites' ? '0 0 0 3px rgba(0, 111, 155, 0.7)' : '0 0 0 3px rgba(0, 0, 0, 0.09)',
      }"
      (click)="toggleFavoritesFilter()"
    >
      Favoriten
    </button>
  </div>

  <!-- Loading state -->
  <div *ngIf="isLoading && cards.length === 0" class="text-center py-8">
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"></div>
    <p class="text-gray-500 mt-2">Lade Kunden...</p>
  </div>

  <!-- Empty state when no results -->
  <div *ngIf="!isLoading && cards.length === 0" class="text-center py-8">
    <p class="text-gray-500 text-lg mb-2">Keine Kunden gefunden</p>
    <p class="text-gray-400 text-sm" *ngIf="searchTerm || showOnlyFavorites">Versuchen Sie andere Suchbegriffe oder entfernen Sie Filter</p>
  </div>

  <!-- Client cards grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-6" *ngIf="cards.length > 0">
    <!-- Client cards -->
    <div
      *ngFor="let item of cards; let i = index"
      style="box-shadow: 0px 0px 3.5px 3px rgba(0, 0, 0, 0.13)"
      class="bg-white rounded-[20px] px-[30px] pt-[21px] pb-[16px] flex flex-col space-y-4 hover:shadow-lg transition-shadow cursor-pointer"
    >
      <div class="flex justify-between items-start h-[73px]">
        <!-- Company logo -->
        <a [routerLink]="['/clients', item.id]" class="h-[53px] sm:h-[45px] md:h-[40px] max-w-[70%] flex items-center">
          <img *ngIf="item.logo?.path; else defaultLogo" [src]="item.logo.path" [alt]="item.name" class="h-full object-contain max-w-full" (error)="$event.target.style.display = 'none'" />
          <ng-template #defaultLogo>
            <div class="h-full w-20 bg-gray-100 rounded-lg flex items-center justify-center">
              <span class="text-gray-400 text-xs font-bold">{{ item.name.charAt(0) }}</span>
            </div>
          </ng-template>
        </a>
        <div class="flex items-center space-x-2">
          <app-favorite-toggle class="h-6 w-6 flex-shrink-0" [isFavorite]="item.isFavorite" (favoriteChange)="onFavoriteChanged($event, item)" />
        </div>
      </div>

      <!-- Stats -->
      <ul class="text-sm text-primary-200 space-y-2">
        <li [routerLink]="['/clients', item.id]" [queryParams]="{ status: 'new' }">
          <span class="border rounded-full aspect-square px-1 text-black">{{ item.reportCounts?.newReports || 0 }}</span>
          <span class="text-primary-500">neue Reports</span>
        </li>
        <li [routerLink]="['/clients', item.id]" [queryParams]="{ status: 'ongoing' }">
          <span class="border rounded-full aspect-square px-1 text-black">{{ item.reportCounts?.ongoingReports || 0 }}</span>
          <span class="text-primary-500">offene Reports</span>
        </li>
        <li [routerLink]="['/clients', item.id]" [queryParams]="{ status: 'completed' }">
          <span class="border rounded-full aspect-square px-1 text-black">{{ item.reportCounts?.completedReports || 0 }}</span>
          <span class="text-primary-500">abgeschlossene Reports</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- Load more button -->
  <div class="text-center mt-8" *ngIf="hasNextPage && !isLoading">
    <button class="px-6 py-3 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" [disabled]="isLoadingMore" (click)="loadMore()">
      <span *ngIf="!isLoadingMore">Weitere Kunden laden</span>
      <span *ngIf="isLoadingMore" class="flex items-center gap-2">
        <div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500"></div>
        Lade...
      </span>
    </button>
  </div>

  <!-- Results count -->
  <div class="mt-4 text-center text-sm text-gray-500" *ngIf="!isLoading">
    {{ cards.length }} von {{ allCards.length }} Kunden angezeigt
    <span *ngIf="searchTerm || showOnlyFavorites">(gefiltert)</span>
  </div>
</section>
