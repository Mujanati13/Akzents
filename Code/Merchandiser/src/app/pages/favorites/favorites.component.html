<section>
  <h2 translate class="flex text-primary-700 mb-8">
    <app-icon name="favorite_filled" class="w-8 flex items-center mr-1 text-primary-700" /><span class="text-[32px] font-bold font-dm">Favoriten</span>
  </h2>

  <!-- Loading state -->
  <div *ngIf="loading" class="flex justify-center items-center h-64 mb-10">
    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
  </div>

  <!-- Error state -->
  <div *ngIf="error" class="bg-red-50 p-4 rounded-md mb-6">
    <p class="text-red-800">Es ist ein Fehler beim Laden der Favoriten aufgetreten. Bitte versuchen Sie es später erneut.</p>
  </div>

  <!-- Content -->
  <div *ngIf="!loading && !error" class="flex flex-col gap-y-6">
    <!-- Client Projekte section -->
    <div class="border border-gray-300 rounded-[20px] px-[32px] py-[26px] gap-y-[30px] w-full flex flex-col">
      <h2 translate class="flex text-primary-700 items-center">
        <span class="inline-flex items-center justify-center w-10 h-10 rounded-full text-2xl font-medium bg-primary-500 text-white mr-3"> {{ favoriteProjects.length }} </span>
        <span class="text-[20px] font-semibold font-dm text-black">Projekte</span>
      </h2>

      <!-- Project cards grid - same as client dashboard -->
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-6">
        <div *ngFor="let item of favoriteProjects" style="box-shadow: 0px 0px 3.5px 3px rgba(0, 0, 0, 0.13)" class="bg-white rounded-[20px] px-[30px] py-[21px] flex flex-col space-y-6">
          <div class="flex justify-between items-start">
            <div>
              <a class="text-[23px] font-extrabold font-dm cursor-pointer" [routerLink]="['/clients', item.clientCompany.id]" [queryParams]="{ status: 'new' }">{{ item.clientCompany.name }}</a>
              <p class="text-[16.5px] font-black font-dm">{{ item.weekNumber }} / {{ item.dateRange }}</p>
            </div>
            <app-favorite-toggle class="h-6 w-6 flex-shrink-0" [isFavorite]="item.isFavorite" (favoriteChange)="onFavoriteChanged($event, item)" />
          </div>
          <ul class="text-sm text-primary-200 space-y-2">
            <li class="cursor-pointer" [routerLink]="['/clients', item.clientCompany.id]" [queryParams]="{ status: 'new' }">
              <span class="border rounded-full aspect-square px-1 text-black">{{ item.stats.new }}</span>
              <span class="text-primary-500">neue Reports</span>
            </li>
            <li class="cursor-pointer" [routerLink]="['/clients', item.clientCompany.id]" [queryParams]="{ status: 'ongoing' }">
              <span class="border rounded-full aspect-square px-1 text-black">{{ item.stats.open }}</span>
              <span class="text-primary-500">laufende Reports</span>
            </li>
            <li class="cursor-pointer" [routerLink]="['/clients', item.clientCompany.id]" [queryParams]="{ status: 'completed' }">
              <span class="border rounded-full aspect-square px-1 text-black">{{ item.stats.completed }}</span>
              <span class="text-primary-500">abgeschlossene Reports</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Einsätze section -->
    <div class="border border-gray-300 rounded-[20px] px-[32px] py-[26px] gap-y-[30px] w-full flex flex-col">
      <h2 translate class="flex text-primary-700 items-center">
        <span class="inline-flex items-center justify-center w-10 h-10 rounded-full text-2xl font-medium bg-primary-500 text-white mr-3">{{ favoriteReports.length }}</span>
        <span class="text-[20px] font-semibold font-dm text-black">Einsätze</span>
      </h2>

      <!-- Empty state for reports -->
      <div *ngIf="favoriteReports.length === 0" class="text-center py-8 text-gray-500">
        <p>Keine favorisierten Einsätze vorhanden</p>
      </div>

      <!-- Mission cards -->
      <div *ngIf="favoriteReports.length > 0" class="grid sm:grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
        <a
          *ngFor="let report of favoriteReports; let i = index"
          [routerLink]="['/clients', report.clientCompany?.id, 'projects', report.project?.id, 'reports', report.id]"
          [queryParams]="{ referrer: 'favorites', reportStatus: report.status?.name || '' }"
          style="box-shadow: 0px 0px 3.5px 3px rgba(0, 0, 0, 0.13)"
          class="bg-white rounded-[16px] flex justify-center items-center py-[10px] px-[12px] gap-x-[8px] text-[15px] font-dm font-bold cursor-pointer hover:bg-gray-50 transition-colors"
        >
          <p class="flex items-center gap-2 flex-wrap justify-center">
            <span>{{ getBranchLabel(report) }}</span>
            <span class="text-primary-500">•</span>
            <span class="text-primary-500">{{ report.project.name }}</span>
            <span class="text-primary-500">•</span>
            <span class="text-primary-500">{{ getReportPeriod(report) }}</span>
            <span *ngIf="getPlannedDate(report)" class="text-primary-500">•</span>
            <span *ngIf="getPlannedDate(report)" class="text-gray-600 text-sm font-normal">{{ getPlannedDate(report) }}</span>
          </p>
          <app-favorite-toggle class="h-[20px] w-[20px] flex-shrink-0 ml-2" [isFavorite]="true" (favoriteChange)="onFavoriteReportChanged($event, report); $event.stopPropagation()" />
        </a>
      </div>
    </div>
  </div>
</section>
